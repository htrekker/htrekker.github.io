
<!DOCTYPE html>
<html lang="">

<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <meta property="og:title" content=" Skip List A Brief Introduction &middot;  Pasilo" />
    <meta property="og:site_name" content="Pasilo" />
    <meta property="og:url" content="https://htrekker.github.io/post/skiplit/" />

    
    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content="2019-12-25T14:57:04&#43;08:00" />
    

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta name="twitter:title" content="Skip List A Brief Introduction" />
    
    <meta name="twitter:description" content="听说跳表很厉害，那么&hellip;一起来学学跳表吧！" />
    <meta name="twitter:url" content="https://htrekker.github.io/post/skiplit/" />
    

    <title> Skip List A Brief Introduction &middot;  Pasilo</title>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="preload" href="https://htrekker.github.io//js/main.js" as="script" />
    <link rel="preload" href="https://htrekker.github.io//css/main.css" as="style" />
    
    
    <link rel="shortcut icon" href="" />
    


    
    <meta name="description" content="Everything is awesome !" />
    

    
    <meta name="p:domain_verify" content=""/>
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    

    
    <link href="https://htrekker.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Pasilo" />
    

    
    <link rel="canonical" href="https://htrekker.github.io/post/skiplit/" />

    
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https:\/\/htrekker.github.io\/post\/skiplit\/"
        },
        "headline": "Skip List A Brief Introduction",
        "description": "",
        "author": {
            "@type": "Person",
            "name": "FirstName LastName",
            "url": "http://profiles.google.com/?rel=author",
            "image": {
              "@type": "ImageObject",
              "url": "https:\/image\/logo.png",
              "height": 80,
              "width": 80
            }
        },
        "publisher": {
          "@type": "Organization",
          "@id": "https:\/\/htrekker.github.io\/",
          "name": "Pasilo",
          "url": "https:\/\/htrekker.github.io\/",
          "logo": {
            "@type": "ImageObject",
            "url": "https:\/image\/logo.png",
            "height": 80,
            "width": 80
          }
        },
        
        "image": {
          "@type": "ImageObject",
          "url": "\/image\/logo.png",
          "height": 80,
          "width": 80
        },
        "datePublished": "2019-12-25",
        "dateModified": "2019-12-25",
        "wordCount":  540 ,
        
    }
    </script>
    

    
    <script type="text/javascript">
        
        
    </script>
    

    <script type="text/javascript">
        var config = {
            baseUrl: "https:\/\/htrekker.github.io\/"
        };
    </script>

    <style>
html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,figure,footer,header,main,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:300;src:local("Merriweather Sans Light"),local(MerriweatherSans-Light),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowY_zIojJi0m4a5Z6tRh6itY.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:400;src:local("Merriweather Sans Regular"),local(MerriweatherSans-Regular),url(//fonts.gstatic.com/s/merriweathersans/v5/AKu1CjQ4qnV8MUltkAX3sL2aU247V0zTzydO4RoO9Ok.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:700;src:local("Merriweather Sans Bold"),local(MerriweatherSans-Bold),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowQfd-b-I5PxxcmB4_-MNcqw.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:800;src:local("Merriweather Sans ExtraBold"),local(MerriweatherSans-ExtraBold),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowWT7sFQ1Iz1BbpcuCPlgc9Q.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:300;src:local("Merriweather Sans Light Italic"),local(MerriweatherSans-LightItalic),url(//fonts.gstatic.com/s/merriweathersans/v5/nAqt4hiqwq3tzCecpgPmVX9UU5BmOJGkLxUCVv5VXdc.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:400;src:local("Merriweather Sans Italic"),local(MerriweatherSans-Italic),url(//fonts.gstatic.com/s/merriweathersans/v5/3Mz4hOHzs2npRMG3B1ascf0KIgDhPIHb_R-SWdtqte8.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:700;src:local("Merriweather Sans Bold Italic"),local(MerriweatherSans-BoldItalic),url(//fonts.gstatic.com/s/merriweathersans/v5/nAqt4hiqwq3tzCecpgPmVYM8pfYvjMoOxygpzLVILAs.woff) format("woff")}@font-face {font-family: 'Aldrich';font-style: normal;font-weight: 400;src: local('Aldrich Regular'), local('Aldrich-Regular'), url('//fonts.gstatic.com/s/aldrich/v8/j-NnyokbAnhXANS2iZ6Jew.woff2') format('woff2');unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215;font-style:normal}[class^="icon-"]:before{font-family:"icons";font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-arrow-right:before{content:'\e807'}.icon-rss:before{content:'\e808'}body{font:300 1em / 1.5em 'Merriweather Sans',sans-serif;color:#595B66}a{color:inherit;text-decoration:none;font-weight:400}h1,h2{text-rendering:optimizeLegibility;color:#1F2026}h2 a{font-weight:inherit}h1{font-size:2em;line-height:1em;margin:2em 0 -.5em}h2{font-size:1.75em;line-height:1.143em;margin:2.286em 0 -.571em}p{margin:2em auto}i{font-weight:400;font-style:italic;color:#363740}img{display:block;max-width:100%;height:auto;margin:2.5em auto}body{background:#fff}.inner{max-width:48em;margin:0 auto;padding:0 1em}#wrapper{position:relative;box-sizing:border-box;width:100%;min-height:100vh;padding-bottom:6em;background:#F2F3F5}#push{transform:translate3d(0,0,0);transform-style:preserve-3d;opacity:1}#nav{position:relative;background:#fff;z-index:70;transform:translate3d(0,0,0);transform-style:preserve-3d;opacity:1}#nav:after{clear:both;content:'';display:table}#nav .nav-logo{float:left;height:2em;padding:1em;max-width:50%}#nav .nav-logo img{width:auto;max-width:none;height:2em;margin:0;border-radius:5px}#nav .nav-menu{float:right}#nav .nav-menu:after{clear:both;content:'';display:table}#nav .nav-menu a{display:block;width:1em;height:1em;line-height:1em;padding:1.5em;text-align:center;float:left}#nav .nav-menu a i:before{margin:auto}.overlay{display:none;position:fixed;left:0;top:0;width:100%;height:100%;z-index:80;display:none}.overlay:before{content:'';position:absolute;left:0;top:0;width:100%;height:100%;background:#1F2026;opacity:0;transform-style:preserve-3d}#header{position:relative;padding:4em 0}#header .inner{position:relative;z-index:2}#header .header-title{display:block;text-align:center}#header .header-name{font-family: Aldrich, sans-serif;font-weight:700;letter-spacing:-1px;display:block;line-height:1em;font-size:2em;text-decoration:none;color:#1F2026;padding:0;margin:0}#header.has-cover .header-name{color:#fff}#header .header-description{display:block;margin:1em auto 0;color:#9D9FA6;position:relative;font-weight:300}#header .header-description:after{content:'';position:absolute;height:1px;width:100px;margin-left:-50px;left:50%;top:-.5em;background:#D4D5D9}#header.has-cover .header-description{color:#fff}#header.has-cover .header-description:after{background:#fff}#header .header-cover{position:absolute;width:100%;height:100%;top:0;left:0;margin-top:-4em;padding:4em 0;background:no-repeat fixed center 100% / cover;z-index:1}#header .header-cover:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background:rgba(0,0,0,0.2)}#header .header-cover:after{content:'';position:absolute;width:100%;left:0;bottom:0;border-bottom:4px solid #19A0D7}#footer{position:absolute;width:100%;left:0;bottom:0;font-size:.75em;line-height:1.334em;background:#1F2026;color:#737580;z-index:20;transform:translate3d(0,0,0);transform-style:preserve-3d;opacity:1}#footer a{color:#9D9FA6;font-weight:400}#footer .credits{text-align:center;font-size:.75em;line-height:1.334em;padding:2.667em;overflow:auto}#footer .credits span{display:block}#footer .credits .credits-theme{float:left}#footer .credits .credits-software{float:right}.post{position:relative;z-index:20}.post .post-image{display:block;margin:0;padding:0}.post .post-image img{display:block;width:100%;height:auto;margin:0;padding:0}.post .post-meta{display:block;font-size:.75em;line-height:1.334em;font-weight:400;margin-bottom:1.334em}.post .post-title{position:relative;color:#000;font-size:2em;line-height:1.375em;font-weight:800;text-indent:-1px;margin:.25em 0 .75em}.post .post-title:before{content:'';position:absolute;left:0;bottom:-.334em;width:1em;margin-bottom:-2px;border-bottom:4px solid #19A0D7}.post .post-title a{text-decoration:none;color:inherit;font-weight:inherit}#post-index{position:relative;max-width:1200px;margin:0 auto 4em;padding:.5em;z-index:10}@keyframes fade{0%{transform:translate3d(0,3em,0);opacity:0}100%{transform:translate3d(0,0,0);opacity:1}}.post-list{position:relative}.post-list .post{float:left;width:33.3%;transform:translate3d(0,3em,0);transform-style:preserve-3d;opacity:0;animation:fade ease-out .5s forwards;animation-delay:1.4s}@media only screen and (max-width: 50em){.post-list .post{width:49.9%}}@media only screen and (max-width: 30em){.post-list .post{width:100%;float:none}}.post-list .post:nth-child(1){animation-delay:.1s}.post-list .post:nth-child(2){animation-delay:.2s}.post-list .post:nth-child(3){animation-delay:.3s}.post-list .post:nth-child(4){animation-delay:.4s}.post-list .post:nth-child(5){animation-delay:.5s}.post-list .post:nth-child(6){animation-delay:.6s}.post-list .post:nth-child(7){animation-delay:.7s}.post-list .post:nth-child(8){animation-delay:.8s}.post-list .post:nth-child(9){animation-delay:.9s}.post-list .post .inner{padding:2em;margin:.5em;max-width:none;background:#fff;box-sizing:border-box;transform:scale(1);transform-style:preserve-3d}@media only screen and (max-width: 50em){.post-list .post .inner{padding:1em}}.post-list .post .post-link{position:absolute;left:0;top:0;width:100%;height:100%;z-index:10}.post-list .post .post-image{position:relative;margin:-2em -2em 0;overflow:hidden;background:#19A0D7}@media only screen and (max-width: 50em){.post-list .post .post-image{margin:-1em -1em 0}}.post-list .post .post-image img{transform:scale(1);transform-style:preserve-3d;opacity:1}.post-list .post .post-image:after{content:'';position:absolute;left:-5%;bottom:-2.5em;width:110%;height:4em;background:#fff;border-top:4px solid #19A0D7;box-shadow:0 0 2em rgba(0,0,0,0.2);transform:rotate(5deg)}.post-list .post .post-title{font-size:1.5em;line-height:1.167em}.post-list .post .post-excerpt{margin:0}.post-list .post .post-more{display:block;margin-top:1.5em}.post-list .post .post-more a{display:inline-block;font-size:.875em;line-height:1.143em;font-weight:400;color:#363740}.post-list .post .post-more a i{color:#0e77a0}.pagination{min-height:3em;margin:4em auto 2em;padding:0;position:relative}.pagination .pagination-item{position:relative;display:block;height:3em;line-height:3em;padding:0 1em;text-align:center;text-decoration:none;font-weight:700;color:#363740;border:1px solid #19A0D7;border-radius:4em;z-index:60}.pagination .pagination-item i{position:relative}@media only screen and (max-width: 30em){.pagination .pagination-item{width:4em;height:4em;line-height:4em;margin-top:-.5em;padding:0!important}.pagination .pagination-item i{font-size:1.5em}.pagination .pagination-item>span{display:none}}.pagination .pagination-prev{float:right}.pagination .pagination-prev i{right:-.05em}.pagination .pagination-info{display:block;left:0;top:0;height:3em;line-height:3em;position:absolute;text-align:center;width:100%;z-index:50;color:#9D9FA6}#loader-wrapper{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000}#loader{display:block;position:relative;left:50%;top:50%;width:150px;height:150px;margin:-75px 0 0 -75px;border-radius:50%;border:3px solid transparent;border-top-color:#19A0D7;animation:spin 2s linear infinite}#loader:before{content:"";position:absolute;top:5px;left:5px;right:5px;bottom:5px;border-radius:50%;border:3px solid transparent;border-top-color:#0e77a0;animation:spin 3s linear infinite}#loader:after{content:"";position:absolute;top:15px;left:15px;right:15px;bottom:15px;border-radius:50%;border:3px solid transparent;border-top-color:#D4D5D9;animation:spin 1.5s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
</style>


</head>
<body class="home-template">
<div id="loader-wrapper">
    <div id="loader"></div>
</div>
<section id="wrapper" style="display: none;">
    <div id="ajax-container">
        <nav id="nav" class="nav">
            <div class="nav-logo">
                <a href="https://htrekker.github.io/">
                    
                    <img src="/images/logo.png" alt="Logo"/>
                    
                </a>
            </div>
            <div id="main-menu" class="nav-menu">
                
                
                <a id="search-button" onclick="$('#search-form').toggle();" title="Search"><i class="fa fa-search"></i></a>
                <form id="search-form" method="get" role="search" action="https://google.com/search">
                    <input type="hidden" name="as_sitesearch" value="https://htrekker.github.io/">
                    <input type="text" name="q" maxlength="255" placeholder="Search..." class="form-control">
                    <input type="submit" value="Search">
                </form>
                
                
                
                
                <a id="main-menu-button" class="menu" data-action="menu" data-target="menu"
                   title="Menu"><i class="fa fa-navicon"></i></a>
                
            </div>
        </nav>


<main class="content" role="main">
    <article class="post">
        <div class="inner">

            <div id="push">

                <header class="post-header">
                
                    <span class="post-meta">
                        <span class="post-date">25 Dec 2019</span> <span class="reading-time">| <span class="estimated-reading-time">3 min.</span> (<span class="word-count">540</span> words)</span></span>
                    </span>
                <div class="clear"></div>
                
                <h1 class="post-title">Skip List A Brief Introduction</h1>
              </header>

              <section class="post-content">
                
                  <p>听说跳表很厉害，那么&hellip;一起来学学跳表吧！</p>
<blockquote>
<p>Skip lists are a data structure that can be used in place of balanced trees. Skip lists use <strong>probabilistic balancing</strong> rather than strictly enforced balancing and as a result the algorithms for insertion and deletion in skip lists are much simpler and significantly faster than equivalent algorithms for balanced trees.</p>
</blockquote>
<h2 id="heading">从链表到跳表</h2>
<p>在具体介绍什么是跳表之前，我们可以先考虑一下链表。如果想要在链表中查询一个值是否存在，我们就需要从头到尾遍历一遍这个链表直到找到该值或者达到链表的末尾。显而易见，这种方式进行查询的时间复杂度为$O(n)$。那么，有什么办法可以加快搜索的速度呢？方法其实很简单就是<strong>加索引</strong>。</p>
<h3 id="heading-1">增加索引</h3>
<p>对于一个有序的数组，<strong>二分查找</strong>是一种非常高效的查询方式。其时间复杂度仅有$O(\log{n})$，这相比于顺序查询快了很多。如果我们把二分查找的搜索路径画出来，我们就会得到一种叫做<strong>平衡搜索树</strong>的东西（见下图）。</p>
<p>此时，我们将左节点画平，右节点画直。这种数据结构就是跳表：</p>
<h2 id="a-pretty-naive-implementation">A Pretty Naive Implementation</h2>
<p>这个实现主要参考了作者的原论文<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>和<!-- raw HTML omitted -->@somenzz的博客<!-- raw HTML omitted --><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>在这里先表示感谢！代码请见：<a href="https://github.com/htrekker/skiplist">https://github.com/htrekker/skiplist</a></p>
<h3 id="heading-2">数据结构的设计</h3>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">class</span> <span style="color:#cb4b16">SkiplistNode</span> {
    <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">value</span>;
    <span style="color:#268bd2">SkiplistNode</span>[] <span style="color:#268bd2">next</span>;<span style="color:#93a1a1;font-style:italic">// 使用链式的存储方式不仅效率低下而且非常浪费空间
</span><span style="color:#93a1a1;font-style:italic"></span>
    <span style="color:#859900">public</span> <span style="color:#268bd2">SkiplistNode</span>(<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">level</span>, <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">value</span>) {
        <span style="color:#268bd2">next</span> = <span style="color:#859900">new</span> <span style="color:#268bd2">SkiplistNode</span>[<span style="color:#268bd2">level</span>];
        <span style="color:#859900">this</span>.<span style="color:#268bd2">value</span> = <span style="color:#268bd2">value</span>;
    }
	
   <span style="color:#93a1a1;font-style:italic">/**
</span><span style="color:#93a1a1;font-style:italic">    * 返回这个node的高度
</span><span style="color:#93a1a1;font-style:italic">    */</span>
    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">level</span>() {
        <span style="color:#859900">return</span> <span style="color:#268bd2">next</span>.<span style="color:#268bd2">length</span>;
    }
}
</code></pre></div><div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900">class</span> <span style="color:#cb4b16">Skiplist</span> {

    <span style="color:#859900">private</span> <span style="color:#268bd2">SkiplistNode</span> <span style="color:#268bd2">root</span>;
    <span style="color:#859900">private</span> <span style="color:#859900">static</span> <span style="color:#859900">final</span> <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">MAX_LEVEL</span> = <span style="color:#268bd2">32</span>;
    <span style="color:#859900">private</span> <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">currentMaxLevel</span> = <span style="color:#268bd2">0</span>;

    <span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">int</span>[] <span style="color:#268bd2">levels</span> = <span style="color:#859900">new</span> <span style="color:#859900;font-weight:bold">int</span>[<span style="color:#268bd2">MAX_LEVEL</span> + <span style="color:#268bd2">1</span>];
    <span style="color:#859900">private</span> <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">size</span> = <span style="color:#268bd2">0</span>;

    <span style="color:#859900">public</span> <span style="color:#268bd2">Skiplist</span>() {
        <span style="color:#268bd2">root</span> = <span style="color:#859900">new</span> <span style="color:#268bd2">SkiplistNode</span>(<span style="color:#268bd2">32</span>, -<span style="color:#268bd2">1</span>);
    }
 
    ...

}
</code></pre></div><h3 id="heading-3">搜索操作</h3>
<p>搜索主要包括两个操作：一个是在某一层索引水平移动，另一个是在某个节点向下层索引移动。操作一的类似于顺序检索一个单链表，操作二类似于顺序检索一个数组。算法的描述如下：</p>
<ul>
<li>从当前最高的索引层开始搜索：
<ul>
<li>如果当前层的下一个索引节点大于于目标节点，则检索下一层索引；</li>
<li>如果当前层的下一个索引节点小于目标值，则水平向前遍历；</li>
<li>如果当前节点的值等于目标值，则返回目标值；</li>
</ul>
</li>
<li>如果到达第0层索引且未找到目标值，则返回未找到目标值。</li>
</ul>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">boolean</span> <span style="color:#268bd2">search</span>(<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">target</span>) {
    <span style="color:#268bd2">SkiplistNode</span> <span style="color:#268bd2">cur</span> = <span style="color:#268bd2">root</span>;
    <span style="color:#859900">for</span> (<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">i</span> = <span style="color:#268bd2">currentMaxLevel</span> - <span style="color:#268bd2">1</span>; <span style="color:#268bd2">i</span> &gt;= <span style="color:#268bd2">0</span>; <span style="color:#268bd2">i</span>--) {
        <span style="color:#93a1a1;font-style:italic">// move along the level
</span><span style="color:#93a1a1;font-style:italic"></span>        <span style="color:#859900">while</span> (<span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>] != <span style="color:#859900;font-weight:bold">null</span> &amp;&amp; <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>].<span style="color:#268bd2">value</span> &lt; <span style="color:#268bd2">target</span>)
            <span style="color:#268bd2">cur</span> = <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>];
        <span style="color:#93a1a1;font-style:italic">// if target is found, stop search
</span><span style="color:#93a1a1;font-style:italic"></span>        <span style="color:#859900">if</span> (<span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>] != <span style="color:#859900;font-weight:bold">null</span> &amp;&amp; <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>].<span style="color:#268bd2">value</span> == <span style="color:#268bd2">target</span>)
            <span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">true</span>;
        <span style="color:#93a1a1;font-style:italic">// move down the node
</span><span style="color:#93a1a1;font-style:italic"></span>    }
    <span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">false</span>;
}
</code></pre></div><h3 id="heading-4">插入操作</h3>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">void</span> <span style="color:#268bd2">findPath</span>(<span style="color:#268bd2">SkiplistNode</span>[] <span style="color:#268bd2">path</span>, <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">num</span>, <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">level</span>) {
    <span style="color:#268bd2">SkiplistNode</span> <span style="color:#268bd2">cur</span> = <span style="color:#268bd2">root</span>;
    <span style="color:#859900">for</span> (<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">i</span> = <span style="color:#268bd2">Math</span>.<span style="color:#268bd2">max</span>(<span style="color:#268bd2">level</span>, <span style="color:#268bd2">currentMaxLevel</span>) - <span style="color:#268bd2">1</span>; <span style="color:#268bd2">i</span> &gt;= <span style="color:#268bd2">0</span>; <span style="color:#268bd2">i</span>--) {
        <span style="color:#859900">while</span> (<span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>] != <span style="color:#859900;font-weight:bold">null</span> &amp;&amp; <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>].<span style="color:#268bd2">value</span> &lt; <span style="color:#268bd2">num</span>)
            <span style="color:#268bd2">cur</span> = <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>];
        <span style="color:#268bd2">path</span>[<span style="color:#268bd2">i</span>] = <span style="color:#268bd2">cur</span>;
    }
}
</code></pre></div><div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">void</span> <span style="color:#268bd2">add</span>(<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">num</span>) {
    <span style="color:#859900">if</span> (<span style="color:#268bd2">num</span> == <span style="color:#268bd2">root</span>.<span style="color:#268bd2">value</span>)
        <span style="color:#859900">return</span>;
    <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">level</span> = <span style="color:#268bd2">SkiplistHelper</span>.<span style="color:#268bd2">getLevel</span>();
    <span style="color:#268bd2">SkiplistNode</span>[] <span style="color:#268bd2">update</span> = <span style="color:#859900">new</span> <span style="color:#268bd2">SkiplistNode</span>[<span style="color:#268bd2">Math</span>.<span style="color:#268bd2">max</span>(<span style="color:#268bd2">level</span>, <span style="color:#268bd2">currentMaxLevel</span>)];
    <span style="color:#268bd2">levels</span>[<span style="color:#268bd2">level</span>]++;
    <span style="color:#268bd2">size</span>++;
    <span style="color:#268bd2">findPath</span>(<span style="color:#268bd2">update</span>, <span style="color:#268bd2">num</span>, <span style="color:#268bd2">level</span>);
    <span style="color:#93a1a1;font-style:italic">/*
</span><span style="color:#93a1a1;font-style:italic">     * insert
</span><span style="color:#93a1a1;font-style:italic">     */</span>
    <span style="color:#268bd2">SkiplistNode</span> <span style="color:#268bd2">newNode</span> = <span style="color:#859900">new</span> <span style="color:#268bd2">SkiplistNode</span>(<span style="color:#268bd2">level</span>, <span style="color:#268bd2">num</span>);
    <span style="color:#859900">for</span> (<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">i</span> = <span style="color:#268bd2">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">level</span>; <span style="color:#268bd2">i</span>++) {
        <span style="color:#268bd2">newNode</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>] = <span style="color:#268bd2">update</span>[<span style="color:#268bd2">i</span>].<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>];
        <span style="color:#268bd2">path</span>[<span style="color:#268bd2">i</span>].<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>] = <span style="color:#268bd2">newNode</span>;
    }
    <span style="color:#859900">this</span>.<span style="color:#268bd2">currentMaxLevel</span> = <span style="color:#268bd2">Math</span>.<span style="color:#268bd2">max</span>(<span style="color:#268bd2">currentMaxLevel</span>, <span style="color:#268bd2">level</span>);
}
</code></pre></div><h3 id="heading-5">删除操作</h3>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900;font-weight:bold">boolean</span> <span style="color:#268bd2">erase</span>(<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">num</span>) {
    <span style="color:#268bd2">SkiplistNode</span> <span style="color:#268bd2">update</span> = <span style="color:#859900">new</span> <span style="color:#268bd2">SkiplistNode</span>[<span style="color:#268bd2">currentMaxLevel</span>];
    <span style="color:#268bd2">findPath</span>(<span style="color:#268bd2">update</span>, <span style="color:#268bd2">num</span>, <span style="color:#268bd2">0</span>);

    <span style="color:#268bd2">SkiplistNode</span> <span style="color:#268bd2">eraseable</span> = <span style="color:#268bd2">update</span>[<span style="color:#268bd2">0</span>].<span style="color:#268bd2">next</span>[<span style="color:#268bd2">0</span>];
    <span style="color:#859900">if</span> (<span style="color:#268bd2">eraseable</span> == <span style="color:#859900;font-weight:bold">null</span> || <span style="color:#268bd2">eraseable</span>.<span style="color:#268bd2">value</span> != <span style="color:#268bd2">num</span>)
        <span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">false</span>;
    <span style="color:#859900">else</span> {
        <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">level</span> = <span style="color:#268bd2">eraseable</span>.<span style="color:#268bd2">level</span>();
        <span style="color:#268bd2">size</span>--;
        <span style="color:#268bd2">levels</span>[<span style="color:#268bd2">level</span>]--;
        <span style="color:#859900">for</span> (<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">i</span> = <span style="color:#268bd2">0</span>; <span style="color:#268bd2">i</span> &lt; <span style="color:#268bd2">level</span>; <span style="color:#268bd2">i</span>++)
            <span style="color:#268bd2">update</span>[<span style="color:#268bd2">i</span>].<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>] = <span style="color:#268bd2">eraseable</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>];
        <span style="color:#859900">return</span> <span style="color:#859900;font-weight:bold">true</span>;
    }
}
</code></pre></div><h3 id="heading-6">获取一个区间内的数</h3>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#268bd2">List</span>&lt;<span style="color:#268bd2">Integer</span>&gt; <span style="color:#268bd2">findRange</span>(<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">begin</span>, <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">end</span>) {
    <span style="color:#268bd2">List</span>&lt;<span style="color:#268bd2">Integer</span>&gt; <span style="color:#268bd2">list</span> = <span style="color:#859900">new</span> <span style="color:#268bd2">ArrayList</span>&lt;&gt;();

    <span style="color:#268bd2">SkiplistNode</span> <span style="color:#268bd2">cur</span> = <span style="color:#268bd2">root</span>;
    <span style="color:#859900">for</span>(<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">i</span> = <span style="color:#268bd2">currentMaxLevel</span> - <span style="color:#268bd2">1</span>; <span style="color:#268bd2">i</span> &gt;= <span style="color:#268bd2">0</span>; <span style="color:#268bd2">i</span>--) {
        <span style="color:#859900">while</span>(<span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>] != <span style="color:#859900;font-weight:bold">null</span> &amp;&amp; <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>].<span style="color:#268bd2">value</span> &lt; <span style="color:#268bd2">begin</span>)
            <span style="color:#268bd2">cur</span> = <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>];
        <span style="color:#859900">if</span>(<span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>] != <span style="color:#859900;font-weight:bold">null</span> &amp;&amp; <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>].<span style="color:#268bd2">value</span> == <span style="color:#268bd2">begin</span>) {
            <span style="color:#268bd2">cur</span> = <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">i</span>];
            <span style="color:#859900">break</span>;
        }
    }
    <span style="color:#859900">while</span>(<span style="color:#268bd2">cur</span> != <span style="color:#859900;font-weight:bold">null</span> &amp;&amp; <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">value</span> &lt;= <span style="color:#268bd2">end</span>) {
        <span style="color:#268bd2">list</span>.<span style="color:#268bd2">add</span>(<span style="color:#268bd2">cur</span>.<span style="color:#268bd2">value</span>);
        <span style="color:#268bd2">cur</span> = <span style="color:#268bd2">cur</span>.<span style="color:#268bd2">next</span>[<span style="color:#268bd2">0</span>];
    }

    <span style="color:#859900">return</span> <span style="color:#268bd2">list</span>;
}
</code></pre></div><h2 id="why-skip-list">Why Skip List？</h2>
<p>原作者在其论文<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>中提到，相比于红黑树，跳表有很多优点。如：</p>
<ol>
<li>虽然两者在理论上，复杂度均为$O(\log{n})$。但是，跳表可以提供一个更小的系数。而这个系数能够提供相当惊人的性能提升。例如：假设有A和B两种查询的复杂度均为$O(\log{n})$的数据结构，B的速度是A的两倍快。那么，在A处理完成规模为$n$的时间内，B能够处理完成规模为$n^2$的数据量。</li>
<li>在编程的复杂度上。由于跳表是通过随机的选择节点高度，没有自平衡的过程。所以，在编程的复杂度上远小于红黑树。</li>
<li></li>
</ol>
<h2 id="skip-list">Skip List的一些优化技巧</h2>
<h3 id="o1level-generator">O(1)复杂度的level generator</h3>
<p>参考<!-- raw HTML omitted -->这篇博客<!-- raw HTML omitted --><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>所写的内容，一般在实现随机生成的<code>level</code>时，会重复调用随机数生成器。如原论文<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>中提到的<code>level</code>的生成算法：</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#268bd2">randomLevel</span>()
	<span style="color:#268bd2">lvl</span> := <span style="color:#2aa198;font-weight:bold">1</span>
	-- <span style="color:#268bd2">random</span>() <span style="color:#268bd2">that</span> <span style="color:#268bd2">returns</span> <span style="color:#268bd2">a</span> <span style="color:#268bd2">random</span> <span style="color:#268bd2">value</span> <span style="color:#268bd2">in</span> [<span style="color:#2aa198;font-weight:bold">0.</span>.<span style="color:#2aa198;font-weight:bold">.1</span>)
	<span style="color:#859900">while</span> <span style="color:#268bd2">random</span>() &lt; <span style="color:#268bd2">p</span> <span style="color:#268bd2">and</span> <span style="color:#268bd2">lvl</span> &lt; <span style="color:#268bd2">MaxLevel</span> <span style="color:#859900">do</span>
		<span style="color:#268bd2">lvl</span> := <span style="color:#268bd2">lvl</span> + <span style="color:#2aa198;font-weight:bold">1</span>
	<span style="color:#859900">return</span> <span style="color:#268bd2">lvl</span>
</code></pre></div><p>由于随机数生成的随机数是均匀分布的。所以，只需要调用一次随机数生成器就可以完成。从而做到$O(1)$的时间复杂度。具体实现如下：</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#859900">public</span> <span style="color:#859900">static</span> <span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">getLevel</span>() {
	<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">flips</span> = <span style="color:#268bd2">rand</span>.<span style="color:#268bd2">nextInt</span>();
	<span style="color:#859900;font-weight:bold">int</span> <span style="color:#268bd2">level</span> = <span style="color:#268bd2">0</span>;
	<span style="color:#859900">while</span> (<span style="color:#268bd2">level</span>++ &lt; <span style="color:#268bd2">MAX_LEVEL</span> &amp;&amp; (<span style="color:#268bd2">flips</span> &amp; <span style="color:#268bd2">1</span>) != <span style="color:#268bd2">0</span>)
		<span style="color:#268bd2">flips</span> &gt;&gt;= <span style="color:#268bd2">1</span>;

	<span style="color:#859900">return</span> <span style="color:#268bd2">level</span>;
}
</code></pre></div><p>StackOverFlow上的一篇回答<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>对C++标准库中的set (底层是红黑树) 和其自己实现的一个跳表进行了benchmark。同时，这个回答还展示了其对自己实现的skiplist进行优化的过程。</p>
<h2 id="simple-benchmark">Simple Benchmark</h2>
<h2 id="heading-7">参考文献</h2>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>William Pugh (1990). <em><a href="https://www.epaperpress.com/sortsearch/download/skiplist.pdf">Skip Lists: A Probabilistic Alternative to Balanced Trees</a></em>. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>somnzz (2019) 跳表这种高效的数据结构，值得每一个程序员掌握. [OL] <a href="https://zhuanlan.zhihu.com/p/54869087">https://zhuanlan.zhihu.com/p/54869087</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>ticki's bolg (2016). <em>Skiplist done right</em>. [OL]  <a href="http://ticki.github.io/blog/skip-lists-done-right">http://ticki.github.io/blog/skip-lists-done-right</a> <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>Dragon Energy (2015). Answer #34003558. [OL] <a href="https://stackoverflow.com/questions/31580869/skip-lists-are-they-really-performing-as-good-as-pugh-paper-claim/34003558#34003558">https://stackoverflow.com/questions/31580869/skip-lists-are-they-really-performing-as-good-as-pugh-paper-claim/34003558#34003558</a> <a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
              </section>

              <footer class="post-footer">
                  <div class="post-tags">
            
                  </div>
                
              </footer>

            
                <aside class="post-comments">
    
    
    
</aside>

            
            </div>

            <nav class="post-nav">
                
                    <a class="post-nav-item post-nav-next" href="https://htrekker.github.io/post/leetcode%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">
                        <section class="post-nav-teaser">
                            <span class="post-nav-icon"><i class="fa fa-chevron-left"></i></span>
                            <span class="post-nav-info">
                                <h4 class="post-nav-title">LeetCode 做题记录</h4>
                            </span>
                        </section>
                    </a>
                
                
                <div class="clear"></div>
            </nav>

        </div>
    </article>
</main>

                <div id="body-class" style="display: none;"></div>
                <footer id="footer">
                    <section class="credits">
                        <span class="credits-license"><i class="fa fa-copyright"></i>2020 Pasilo
                    </span>
                    </section>
                </footer>
                

                
<div id="menu" data-target="menu">
    <div class="menu-header">
        <span class="menu-label">Menu</span>
        <a class="menu-close" data-action="menu" data-target="menu"></a>
    </div>

    <div class="menu-list">
        
        
        <li class="menu-list-item">
            
            <a class="home current js-ajax-link" href="/post">Pasilo的博客</a>
        </li>
        
        
        <li class="menu-list-item">
            
            <a class="home current js-ajax-link" href="/about">About me</a>
        </li>
        
        <li class="menu-list-item menu-list-social">
            <a href="https://twitter.com/" title="Entre Dev Y Ops en Twitter"><i class="fa fa-twitter"></i></a>
            <a href="https://github.com/" title="Entre Dev Y Ops en GitHub"><i class="fa fa-github"></i></a>
        </li>
    </div>

</div>


                
                <div class="overlay"></div>
            </div>
        </section>

    <script async src="https://htrekker.github.io//js/main.js"></script>
    <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });

  MathJax.Hub.Config({
  
  TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script>



  <noscript><link rel="stylesheet" href="https://htrekker.github.io//css/main.css"></noscript>
</body>
</html>

